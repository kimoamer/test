<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Launch Location Verifier</title>
    <!-- Load Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use the Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <div class="bg-white p-8 sm:p-12 rounded-xl shadow-lg text-center w-11/12 max-w-md">
        <h1 class="text-3xl font-bold text-gray-800 mb-4">Location Verifier</h1>
        <p class="text-gray-600 mb-8">Click the button below to open the app and complete your location verification.</p>

        <!-- 
          This button contains the logic to attempt to open your app.
          It passes the username 'testuser' as a query parameter.
        -->
        <button id="launchButton" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded-lg text-lg shadow-md transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
            Launch Verification App
        </button>

        <p class="text-sm text-gray-500 mt-6">
            If the app doesn't open, you may need to <a href="#" id="downloadLink" class="text-blue-600 hover:underline">install it first</a>.
        </p>
    </div>

    <script>
        document.getElementById('launchButton').addEventListener('click', function() {
            // --- YOU MUST EDIT THESE VALUES ---

            // 1. Set your custom URL scheme (from AndroidManifest.xml)
            // Example: 'myapp' or 'locationverifier'
            const customScheme = 'fgr';

            // 2. Set the path from your go_router setup (it's '/verify' in your router.dart)
            const path = 'verify'; // Note: no leading slash for the intent URL path

            // 3. Set the username you want to pass
            const username = 'testuser';

            // 4. Set your app's package name (from android/app/build.gradle, e.g., 'com.example.myapp')
            const packageName = 'com.yourcompany.myapp'; 
            
            // --- END OF REQUIRED EDITS ---


            // This is the deep link URL that your app will receive.
            // It matches the go_router config: /verify?username=testuser
            const deepLinkUrl = `${customScheme}://${path}?username=${username}`;

            // This is the fallback URL to the Google Play Store.
            const playStoreUrl = `https://play.google.com/store/apps/details?id=${packageName}`;

            // Update the download link on the page
            document.getElementById('downloadLink').href = playStoreUrl;

            // We will try to redirect to the Android Intent URL.
            // This is the most robust way to launch an app from a browser on Android.
            const intentUrl = `intent://${path}?username=${username}#Intent;scheme=${customScheme};package=${packageName};end`;
            
            let hasApp = false;
            const timeout = 1500; // 1.5 seconds

            const blurHandler = () => {
                // If the browser window loses focus, we assume the app opened.
                hasApp = true;
            };
            window.addEventListener('blur', blurHandler);

            // 1. Try to navigate using the Android Intent URL
            window.location.href = intentUrl;

            // 2. Set a timer. If the 'blur' event didn't fire (meaning the app
            // didn't open and take focus), redirect to the Play Store.
            setTimeout(() => {
                window.removeEventListener('blur', blurHandler);
                if (!hasApp) {
                    // This check is not 100% reliable, but it's a common fallback.
                    // If the app isn't installed, the intent URL should
                    // ideally fail and this timeout will redirect to the store.
                    console.log('App not detected, redirecting to Play Store.');
                    window.location.href = playStoreUrl;
                }
            }, timeout);
        });
    </script>

</body>
</html>
